class ConsumerQueue{constructor(){this._head=null;this._tail=null;this._waiter=null;this._cancel=null}tryPop(){if(this._head!==null){let t=this._head.data;this._head=this._head.next;if(this._head===null)this._tail=null;return t}else{return null}}next(){return this.pop()}pop(){if(this._head!==null){return Promise.resolve(this.tryPop())}else if(this._waiter!==null){throw new Error("Someone is already waiting on this queue")}else{return new Promise((t,e)=>{this._waiter=t;this._cancel=e})}}cancelWait(t){let e=this._cancel;this._cancel=null;this._waiter=null;if(e)e(t)}hasWaiter(){return this._waiter!==null}push(t){let e=this._waiter;this._waiter=null;this._cancel=null;if(e){e(t)}else if(this._tail===null){this._head=this._tail={data:t,next:null}}else{this._tail.next={data:t,next:null};this._tail=this._tail.next}}}